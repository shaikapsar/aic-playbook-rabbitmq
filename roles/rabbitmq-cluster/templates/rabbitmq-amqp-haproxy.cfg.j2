# HAProxy configuration for RabbitMQ AMQP protocol

{% for host in groups['lb_servers'] %}
    	listen {{ rabbitmq_amqp_daemonname }} {{ hostvars[host]['ansible_' + iface].ipv4.address }}:{{ rabbitmq_amqp_port }}
    	listen {{ rabbitmq_amqp_daemonname }} {{ hostvars[host]['ansible_' + iface].ipv4.address }}:{{ rabbitmq_amqp_port }}
{% endfor %}
balance     {{ rabbitmq_balance }}
{% for host in groups['rabbitmq_servers'] %}
       server {{ host }} {{ hostvars[host]['ansible_' + iface].ipv4.address }}:{{ rabbitmq_amqp_port }}
{% endfor %}
